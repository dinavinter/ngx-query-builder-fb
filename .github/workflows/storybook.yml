# write github action that create a storybook and stories of the available components 
name: storybook
on:
  push:
    branches: 
      - main
  workflow_dispatch:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Use Node.js
        uses: actions/setup-node@v3
      - name: search for angular components in repo
        run: |
          echo "searching for angular components in repo"
          find ./src -name "*.component.ts"   | while read file; do echo "$(basename -- ${file%.component.ts})"; done > components.txt
          echo "found components:"
          cat components.txt
      - name: install storybook
        run: |
          echo "installing storybook"
          npx sb init
      - name: create stories
        run: |
          echo "creating stories"
          while read component; do
            echo "creating story for $component"
            npx sb generate component $component
          done < components.txt
      - name: create pr to storybook branch
        run: |
          echo "creating pr to storybook branch"
          git checkout -b storybook
          git add .
          git commit -m "create storybook"
          git push origin storybook -f
          gh pr create --title "update storybook" --body "update storybook" --base main --head storybook
        
      - name: build storybook
        run: |
          echo "building storybook"
          npx sb build
      - name: deploy storybook
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./storybook-static
        
        
  
